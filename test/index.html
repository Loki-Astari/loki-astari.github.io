<html>
<head>
<title>Social Value Engagement Score</title>
<script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/sha1.js"></script>
<script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/hmac-sha1.js"></script>
<script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/components/enc-base64-min.js"></script>
<script>
function nowTime() {
    if (Date.now) {
        return Date.now() / 1000;
    }
    return new Date().getTime() / 1000;
}
function endTime() {
    //return 1459487766;
    return Math.floor(nowTime()) + (60*60*24);
}
function GetSocialValueEngagementFromMoz(theUrl)
{
   var xmlHttp = new XMLHttpRequest();
   xmlHttp.onreadystatechange = function() { 
       if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
          var resultObj         = JSON.parse(xmlHttpresponseText);
          var resultElement     = document.getElementById('result');
          resultElement.innerHTML   = resultObj.apo.toString();
       }
   }
   xmlHttp.open("GET", theUrl, true); // true for asynchronous 
   xmlHttp.send(null);
}
function GetSocialValueEngagement(accessID, secretKey, domain) {
   var endpoint     = "lsapi.seomoz.com";
   var call         = "/url-metrics/".concat(domain).concat("?Cols=1073741825");
   var timeend      = endTime();
   var stringToSign = accessID.concat("\n").concat(timeend);

   var hash         = CryptoJS.HmacSHA1(stringToSign, secretKey);
   var signature    = CryptoJS.enc.Base64.stringify(hash);

   var urlParts = [ "http://", endpoint, "/linkscape", call,
                    "?AccessID=",   accessID,
                    "&Expires=",    timeend,
                    "&Signature=",  signature
                  ];
   var url = urlParts.join('');
   GetSocialValueEngagementFromMoz(url);
   return true;
}
</script>
</head>
<body>
<h1>Social Value Engagement Score</h1>
<form onsubmit="
    event.preventDefault();
    GetSocialValueEngagement(
        document.getElementById('accessID').value,
        document.getElementById('secretKey').value,
        document.getElementById('domain').value
    );">
    <table>
    <tr><td colspan="2"><div>Get Access ID and key here: https://moz.com/products/api/keys</div></td></tr>
    <tr><td><div>Access ID :</td><td><input type="text" id="accessID"/></div></td></tr>
    <tr><td><div>Secret Key:</td><td><input type="text" id="secretKey"/></div></td></tr>
    <tr><td><div>Domain:</td><td><input value="moz.com" type="text" id="domain"/></div></td></tr>
    <tr><td colspan="2"><input type="submit"></td></tr>
    <tr><td><div>ApO :</div></td><td><div id="result">XX</div></td></tr>
</form>
</body>
