<html>
<head>
<title>Social Value Engagement Score</title>
<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/sha1.js"></script>
<script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/hmac-sha1.js"></script>
<script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/components/enc-base64-min.js"></script>
<script>
function nowTime() {
    if (Date.now) {
        return Date.now() / 1000;
    }
    return new Date().getTime() / 1000;
}
function endTime() {
    //return 1459487766;
    return Math.floor(nowTime()) + (60*60*24);
}
function GetSocialValueEngagementFromMoz(theUrl)
{
   var xmlHttp = new XMLHttpRequest();
   xmlHttp.onreadystatechange = function() { 
       if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
          //var responseText      = "{\"apo\":937294.13,\"ut\":\"\"}";
          //var resultObj         = JSON.parse(responseText);
          var resultObj         = JSON.parse(xmlHttp.responseText);
          var resultElement     = document.getElementById('result');
          resultElement.innerHTML   = resultObj.apo.toString();
       }
   }
   xmlHttp.open("GET", theUrl, true); // true for asynchronous 
   xmlHttp.send(null);
}
function GetSocialValueEngagement(accessID, secretKey, domain) {
   var endpoint     = "lsapi.seomoz.com";
   var call         = "/url-metrics/".concat(domain).concat("?Cols=1073741825");
   var timeend      = endTime();
   var stringToSign = accessID.concat("\n").concat(timeend);

   var hash         = CryptoJS.HmacSHA1(stringToSign, secretKey);
   var signature    = CryptoJS.enc.Base64.stringify(hash);

   var urlParts = [ "http://", endpoint, "/linkscape", call,
                    "?AccessID=",   accessID,
                    "&Expires=",    timeend,
                    "&Signature=",  signature
                  ];
   var url = urlParts.join('');
   GetSocialValueEngagementFromMoz(url);
   return true;
}
</script>
</head>
<body>
<div class="container">
    <div class="jumbotron">
        <h1>Moz</h1>
        <h2>Social Value Engagement Score</h2>
        <p>A measure of the ROI of social engagement for your root domain measured by mentions of company/products or executives.</p>
    </div>

    <form class="form-horizontal" onsubmit="
        event.preventDefault();
        GetSocialValueEngagement(
            document.getElementById('accessID').value,
            document.getElementById('secretKey').value,
            document.getElementById('domain').value
        );
        ">
      <span id="helpBlock" class="help-block">Get Access ID and key <a href="https://moz.com/products/api/keys">here</a></span>

      <div class="form-group">
        <label for="accessID" class="col-sm-2 control-label">Access ID:</label>
        <div class="col-sm-10">
          <input type="text" class="form-control" id="accessID" placeholder="<Your Access ID>">
        </div>
      </div>
      <div class="form-group">
        <label for="secretKey" class="col-sm-2 control-label">Secret Key:</label>
        <div class="col-sm-10">
          <input type="password" class="form-control" id="secretKey" placeholder="<Your SecretKey>">
        </div>
      </div>
      <div class="form-group">
        <label for="domain" class="col-sm-2 control-label">Domain:</label>
        <div class="col-sm-10">
          <input type="text" class="form-control" id="domain" placeholder="moz.com">
        </div>
      </div>
      <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10">
          <button type="submit" class="btn btn-default">Get ApO</button>
        </div>
      </div>
      <div class="form-group">
        <label class="col-sm-2 control-label">Value: $</label>
        <div class="col-sm-10">
          <p class="form-control-static" id="result">0</p>
        </div>
      </div>
    </form>

<!--
    <form onsubmit="
        event.preventDefault();
        GetSocialValueEngagement(
            document.getElementById('accessID').value,
            document.getElementById('secretKey').value,
            document.getElementById('domain').value
        );">
        <table>
        <tr><td colspan="2"><div>Get Access ID and key here: https://moz.com/products/api/keys</div></td></tr>
        <tr><td><div>Access ID :</td><td><input type="text" id="accessID"/></div></td></tr>
        <tr><td><div>Secret Key:</td><td><input type="text" id="secretKey"/></div></td></tr>
        <tr><td><div>Domain:</td><td><input value="moz.com" type="text" id="domain"/></div></td></tr>
        <tr><td colspan="2"><input type="submit"></td></tr>
        <tr><td><div>ApO :</div></td><td><div id="result">XX</div></td></tr>
    </form>
-->
</div>
</body>
